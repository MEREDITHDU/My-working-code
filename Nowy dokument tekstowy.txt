SCL		EQU		P3.1
SDA		EQU		P3.0

DSEG	AT	30H
	
	
CSEG	AT	0H
RESET:
	MOV		SP,#7FH	
	ACALL	I2C_START
	MOV		A,#4EH
	ACALL	I2C_WRITE
	MOV		A,#0FfH
	ACALL	I2C_WRITE
	ACALL	I2C_STOP

LOOP:
	ACALL	I2C_START
	MOV		A,#04FH
	ACALL	I2C_WRITE
	CLR		F0
	ACALL	I2C_READ
	MOV		P0,A
	ACALL	I2C_STOP	
	SJMP	LOOP
		
		
I2C_START:
	CLR		SDA
	NOP
	NOP
	NOP
	NOP
	CLR		SCL
	NOP
	NOP	
	RET


I2C_STOP:
	SETB	SCL
	NOP
	NOP
	NOP
	NOP
	SETB	SDA
	RET
	
I2C_WRITE:
	MOV		R7,#8
I2C_W_LP:	
	RLC		A
	MOV		SDA,C
	NOP
	NOP
	NOP
	NOP
	SETB	SCL
	NOP
	NOP
	NOP
	NOP
	CLR		SCL
	NOP	
	DJNZ	R7,I2C_W_LP
	SETB	SDA
	NOP
	NOP
	NOP
	NOP
	SETB	SCL
	NOP
	NOP
	NOP
	MOV		C,SDA
	CLR		SCL
	RET


I2C_READ:
	MOV		R7,#8
I2C_R_LP:
	SETB	SCL
	NOP
	NOP
	NOP
	NOP
	MOV		C,SDA	
	CLR		SCL
	RLC		A
	NOP
	NOP
	NOP
	DJNZ	R7,I2C_R_LP
	MOV		C,F0
	MOV		SDA,C
	NOP
	NOP
	NOP
	SETB	SCL
	NOP
	NOP
	NOP
	CLR		SCL
	RET



END